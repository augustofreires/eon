#!/usr/bin/expect -f

# Deploy dos logs crÃ­ticos para debug do problema de saldo
set timeout 300

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "ğŸ” DEPLOY: Logs CrÃ­ticos para Debug de Saldo\n"
send_user "ğŸ¯ OBJETIVO: Capturar EXATAMENTE onde estÃ¡ o problema\n"

send "cd /root/eon\r"
expect "# "

# Fazer backup
send "cp -r client /root/eon_client_backup_critical_debug_\$(date +%Y%m%d_%H%M%S)\r"
expect "# "

send_user "ğŸ”¨ Rebuilding com logs crÃ­ticos...\n"
send "cd client && npm run build\r"
expect "# "

send_user "ğŸ“¤ Deploy dos logs crÃ­ticos...\n"
send "rm -rf /usr/share/nginx/html/*\r"
expect "# "

send "cp -r build/* /usr/share/nginx/html/\r"
expect "# "

send "chown -R www-data:www-data /usr/share/nginx/html/\r"
expect "# "

send "chmod -R 755 /usr/share/nginx/html/\r"
expect "# "

send_user "âœ… LOGS CRÃTICOS DEPLOYADOS!\n"
send_user "\nğŸ” LOGS ADICIONADOS:\n"
send_user "   ğŸ” Token tracking em authorize()\n"
send_user "   ğŸ” Balance request debugging\n"
send_user "   ğŸ” Account mismatch detection\n"
send_user "   ğŸ” Retry com delays aumentados\n"
send_user "   ğŸ” Cache de token monitoring\n"
send_user "\nğŸ§ª PRÃ“XIMOS PASSOS:\n"
send_user "   1. Abra https://iaeon.site\n"
send_user "   2. Abra DevTools > Console\n"
send_user "   3. FaÃ§a login e troque de conta\n"
send_user "   4. OBSERVE OS LOGS DETALHADOS\n"
send_user "   5. Identifique onde exatamente falha\n"
send_user "\nğŸ¯ BUSQUE POR:\n"
send_user "   âŒ 'CRITICAL: ACCOUNT MISMATCH!'\n"
send_user "   ğŸ” 'CRITICAL DEBUG:' logs\n"
send_user "   â° 'Balance request timeout'\n"
send_user "   ğŸ”„ 'Final retry result'\n"

interact