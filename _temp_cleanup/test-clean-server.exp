#!/usr/bin/expect -f

set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
   "password:" {
       send "62uDLW4RJ9ae28EPVfp5yzT##\r"
   }
}

expect "# "
send "cd /root/eon\r"
expect "# "

send_user "üß™ TESTANDO SERVIDOR LIMPO\n\n"

send_user "ETAPA 6: Iniciando servidor limpo\n"
send "pm2 start server/index.js --name eon-clean\r"
expect "# "

send_user "\nETAPA 7: Aguardando estabiliza√ß√£o\n"
send "sleep 10\r"
expect "# "

send_user "\nETAPA 8: Teste cr√≠tico - porta 5001\n"
send "curl -s 'http://localhost:5001/api/health' && echo ' ‚úÖ SERVIDOR LIMPO FUNCIONANDO!' || echo ' ‚ùå Ainda quebrado'\r"
expect "# "

send_user "\nETAPA 9: Verificando logs de erro\n"
send "pm2 logs eon-clean --err --lines 5\r"
expect "# "

send_user "\nETAPA 10: Verificando porta via nginx\n"
send "curl -s 'http://localhost/api/health' && echo ' ‚úÖ NGINX FUNCIONANDO!' || echo ' ‚ùå NGINX PROBLEM'\r"
expect "# "

send_user "\nüéØ Se funcionou, agora podemos testar troca de conta!\n"

interact
