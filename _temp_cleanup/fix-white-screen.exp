#!/usr/bin/expect -f

# Corrigir tela branca fazendo rebuild e deploy do frontend
set timeout 300

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "🔧 CORREÇÃO: Rebuild do frontend para corrigir tela branca\n"

send "cd /root/eon\r"
expect "# "

# Verificar estrutura atual
send_user "📁 Verificando estrutura de arquivos:\n"
send "ls -la client/build/static/js/ | head -5\r"
expect "# "

send "ls -la /var/www/html/static/js/ 2>/dev/null | head -5 || echo 'Diretório static não existe'\r"
expect "# "

# Fazer rebuild do frontend
send_user "🔨 Fazendo rebuild do frontend...\n"
send "cd client && npm run build\r"
expect "# "

# Verificar se o build foi criado
send_user "✅ Verificando arquivos gerados:\n"
send "ls -la build/static/js/ | head -5\r"
expect "# "

# Copiar para o diretório web
send_user "📤 Copiando arquivos para /var/www/html/\n"
send "cp -r build/* /var/www/html/\r"
expect "# "

# Verificar se os arquivos foram copiados
send "ls -la /var/www/html/static/js/ | head -5\r"
expect "# "

# Ajustar permissões
send "chown -R www-data:www-data /var/www/html/\r"
expect "# "

send "chmod -R 755 /var/www/html/\r"
expect "# "

send_user "✅ CORREÇÃO APLICADA\n"
send_user "🌐 Site deve estar funcionando agora\n"

interact