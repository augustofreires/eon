#!/usr/bin/expect -f

# Deploy simples da correÃ§Ã£o crÃ­tica de troca de contas
set timeout 60

# Desabilitar uso de chaves SSH
spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
    "Are you sure you want to continue connecting" {
        send "yes\r"
        exp_continue
    }
    timeout {
        send_user "âŒ Timeout na conexÃ£o\n"
        exit 1
    }
}

expect "# "
send_user "âœ… Conectado ao servidor VPS\n"

# Verificar estrutura do projeto
send "find /root -name eonbackend -type d 2>/dev/null\r"
expect "# "

send "ls -la /root/eonbackend/server/routes/ 2>/dev/null\r"
expect "# "

# Se nÃ£o existir, procurar outros locais
send "find /root -name \"auth.js\" -path \"*/routes/auth.js\" 2>/dev/null\r"
expect "# "

send_user "ğŸ” Procurando projeto no servidor...\n"
send "find /var/www -name eonbackend -type d 2>/dev/null\r"
expect "# "

send "find /opt -name eonbackend -type d 2>/dev/null\r"
expect "# "

send "find /home -name eonbackend -type d 2>/dev/null\r"
expect "# "

# Verificar processos PM2
send "pm2 list\r"
expect "# "

send_user "ğŸ“‹ Status atual do servidor verificado\n"
send_user "ğŸ”§ Pronto para localizar e aplicar a correÃ§Ã£o\n"

interact