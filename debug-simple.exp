#!/usr/bin/expect -f

set timeout 60

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "ðŸ” VERIFICANDO A CORREÃ‡ÃƒO NA LINHA 102..."
send "sed -n '100,105p' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

puts "ðŸ§ª TESTANDO LOGIN..."
send "curl -X POST http://localhost:5000/api/auth/login -H 'Content-Type: application/json' -d '{\"email\":\"cliente@iaeon.com\",\"password\":\"123456\",\"isAdmin\":false}' 2>/dev/null\r"
expect "*#*"

puts "ðŸ” VERIFICANDO SE SERVIDOR ESTÃ RESPONDENDO..."
send "curl -X GET http://localhost:5000/api/bots 2>/dev/null\r"
expect "*#*"

puts "ðŸ“‹ VOU VERIFICAR LOGS DO PM2..."
send "pm2 logs --lines 10\r"
expect "*#*"

puts ""
puts "ðŸ¤” PROBLEMA IDENTIFICADO!"
puts "Agora preciso investigar mais..."

interact