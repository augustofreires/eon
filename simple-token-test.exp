#!/usr/bin/expect -f

set timeout 20
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        # Testar banco com usuário correto
        send "su - postgres -c \"psql eonpro_db -c 'SELECT id, email FROM users LIMIT 1;'\"\r"
        expect "*# "

        # Gerar um token válido fazendo login
        send "curl -s -X POST https://iaeon.site/api/auth/login -H 'Content-Type: application/json' -d '{\"email\":\"admin@eon.com\",\"password\":\"123456\",\"isAdmin\":true}' | jq\r"
        expect "*# "

        send "exit\r"
    }
}

expect eof