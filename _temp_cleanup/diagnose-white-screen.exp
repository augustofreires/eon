#!/usr/bin/expect -f

# Diagnosticar problema de tela branca no site
set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "ğŸ” Diagnosticando tela branca no iaeon.site\n"

send "cd /root/eon\r"
expect "# "

# Verificar status do PM2
send_user "ğŸ“Š Status do PM2:\n"
send "pm2 status\r"
expect "# "

# Verificar logs recentes
send_user "\nğŸ“‹ Logs recentes do servidor:\n"
send "pm2 logs eon-pro-server --lines 20\r"
expect "# "

# Verificar se o processo estÃ¡ respondendo
send_user "\nğŸŒ Testando API do servidor:\n"
send "curl -I http://localhost:3001/api/health 2>/dev/null || echo 'API nÃ£o responde'\r"
expect "# "

# Verificar configuraÃ§Ã£o do Nginx
send_user "\nğŸ”§ Verificando Nginx:\n"
send "systemctl status nginx | head -10\r"
expect "# "

# Verificar configuraÃ§Ã£o do site
send "nginx -t\r"
expect "# "

# Verificar se os arquivos estÃ£o servindo
send "curl -I https://iaeon.site 2>/dev/null | head -5 || echo 'Site nÃ£o responde'\r"
expect "# "

send_user "\nğŸ¯ DiagnÃ³stico completo\n"

interact