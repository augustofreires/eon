#!/usr/bin/expect -f

set timeout 60
set password "62uDLW4RJ9ae28EPVfp5yzT##"

puts "üöÄ Conectando e executando deploy direto..."

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*assword*" {
        send "$password\r"
        expect "*#*"

        # Navegar para o diret√≥rio correto
        send "cd /root/eon\r"
        expect "*#*"

        send "pwd\r"
        expect "*#*"

        # Verificar estrutura
        send "ls -la\r"
        expect "*#*"

        # Encontrar arquivos da aplica√ß√£o
        send "find . -name '*AuthContext*' -type f\r"
        expect "*#*"

        send "find . -name '*DerivAccountPanel*' -type f\r"
        expect "*#*"

        send "find . -name '*OperationsPage*' -type f\r"
        expect "*#*"

        # Fazer backup
        send "mkdir -p /tmp/backup-oauth-\$(date +%Y%m%d-%H%M%S)\r"
        expect "*#*"

        puts "‚úÖ Conectado e explorando estrutura..."
        puts "üìã Agora vou aplicar as corre√ß√µes..."

        # Se encontrar os arquivos, aplicar as corre√ß√µes
        send "echo 'Estrutura mapeada, pronto para corre√ß√µes'\r"
        expect "*#*"

        interact
    }
    timeout {
        puts "‚ùå Timeout"
        exit 1
    }
}