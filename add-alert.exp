#!/usr/bin/expect -f

set timeout 30

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "ğŸš¨ ADICIONANDO ALERT NO INÃCIO DA FUNÃ‡ÃƒO..."

# Adicionar alert bem no inÃ­cio da funÃ§Ã£o
send "sed -i '/const loadAvailableBots = async () => {/a\\    alert(\"ğŸš¨ FUNÃ‡ÃƒO loadAvailableBots FOI CHAMADA!\");' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

# Ver se foi adicionado
send "sed -n '98,105p' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

puts "ğŸ—ï¸ BUILD COM ALERT..."
send "cd client && npm run build\r"
expect {
    "*build folder is ready*" {
        puts "âœ… Build OK"
    }
    "*compiled successfully*" {
        puts "âœ… Build OK"
    }
    timeout {
        puts "â° Building..."
    }
}
expect "*#*"

send "cd /root/eon && pm2 restart all\r"
expect "*#*"

puts ""
puts "ğŸš¨ ALERT ADICIONADO!"
puts "ğŸ§ª TESTE AGORA:"
puts "   1. https://iaeon.site/operations"
puts "   2. Login: cliente@iaeon.com / 123456"
puts "   3. Conecte Deriv"
puts ""
puts "â“ SE NÃƒO APARECER O ALERT, a funÃ§Ã£o NEM estÃ¡ sendo executada!"
puts "â“ SE APARECER O ALERT, o problema Ã© OUTRO!"

interact