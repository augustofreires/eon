#!/usr/bin/expect -f

set timeout 60

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "ğŸ” Verificando arquivo de rotas dos bots..."

# Verificar se existe arquivo bots.js
send "ls -la ./server/routes/bot*\r"
expect "*#*"

# Ver conteÃºdo do arquivo bots.js
send "cat ./server/routes/bots.js 2>/dev/null || echo 'Arquivo bots.js nÃ£o encontrado'\r"
expect "*#*"

puts "ğŸ“Š Verificando dados no banco SQLite..."

# Verificar tabelas no banco
send "sqlite3 ./server/database.sqlite '.tables' 2>/dev/null || echo 'Erro ao acessar SQLite'\r"
expect "*#*"

# Verificar se hÃ¡ tabela bots
send "sqlite3 ./server/database.sqlite 'SELECT COUNT(*) as total_bots FROM bots;' 2>/dev/null || echo 'Tabela bots nÃ£o existe'\r"
expect "*#*"

# Verificar estrutura da tabela bots se existir
send "sqlite3 ./server/database.sqlite '.schema bots' 2>/dev/null || echo 'Schema bots nÃ£o existe'\r"
expect "*#*"

puts "ğŸ” Procurando dados de exemplo ou seeds..."

# Procurar por inserÃ§Ãµes de bots
send "grep -rn 'INSERT.*bot\\|bot.*INSERT' ./server/ | head -3\r"
expect "*#*"

# Procurar arquivos de seed
send "find ./server -name '*seed*' -o -name '*fixture*' -o -name '*sample*'\r"
expect "*#*"

puts "ğŸ“‹ Verificando logs do PM2..."

# Ver logs do PM2 para erros relacionados a bots
send "pm2 logs --lines 20 | grep -i 'bot\\|error' || pm2 logs --lines 10\r"
expect "*#*"

interact