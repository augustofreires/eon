#!/usr/bin/expect -f

set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
   "password:" {
       send "62uDLW4RJ9ae28EPVfp5yzT##\r"
   }
}

expect "# "
send "cd /root/eon\r"
expect "# "

send_user "\nüöÄ TESTANDO CORRE√á√ÉO FINAL - TROQUE DE CONTA AGORA!\n"
send_user "üì° Monitorando logs em tempo real ap√≥s deploy...\n\n"

# Monitorar logs com timestamp
send "pm2 logs eon-pro-server --lines 0 --timestamp | grep --line-buffered -E 'switch-account|CRITICAL|Account mismatch|POST|200|400' &\r"
expect "# "

send_user "\n‚è∞ AGUARDE 30 SEGUNDOS - TROQUE DE CONTA AGORA!\n"
send "sleep 30\r"
expect "# "

send "pkill tail\r"
expect "# "

send_user "\n‚úÖ TESTE CONCLU√çDO!\n"

interact
