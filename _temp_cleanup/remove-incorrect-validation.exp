#!/usr/bin/expect -f

# Remover validaÃ§Ã£o incorreta que estÃ¡ impedindo trocas vÃ¡lidas de conta
set timeout 120

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "ğŸ”§ CORREÃ‡ÃƒO: Removendo validaÃ§Ã£o incorreta\n"

send "cd /root/eon\r"
expect "# "

# Fazer backup antes da correÃ§Ã£o
send "cp server/routes/auth.js server/routes/auth.js.backup.before_validation_removal\r"
expect "# "

send_user "ğŸ“ Removendo validaÃ§Ã£o incorreta que impede trocas vÃ¡lidas...\n"

# Remover o bloco de validaÃ§Ã£o que estÃ¡ causando o problema (linhas 1999-2011)
send "sed -i '1999,2011d' server/routes/auth.js\r"
expect "# "

# Verificar se a validaÃ§Ã£o foi removida
send "grep -n -A5 -B5 'Account mismatch' server/routes/auth.js\r"
expect "# "

send_user "âœ… ValidaÃ§Ã£o incorreta removida\n"

# Reiniciar servidor
send "pm2 restart eon-pro-server\r"
expect "# "

send "sleep 3\r"
expect "# "

send "pm2 status\r"
expect "# "

send_user "ğŸ¯ CORREÃ‡ÃƒO APLICADA: Sistema voltou ao comportamento original da Deriv API\n"
send_user "âœ… Troca de contas deve funcionar normalmente agora\n"

interact