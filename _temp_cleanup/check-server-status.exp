#!/usr/bin/expect -f

set timeout 30

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "ğŸš¨ VERIFICANDO STATUS DO SERVIDOR..."

send "pm2 status\r"
expect "*#*"

puts "ğŸ“‹ VERIFICANDO LOGS DE ERRO..."
send "pm2 logs iaeon-server --lines 20\r"
expect "*#*"

puts "ğŸ” VERIFICANDO CONEXÃƒO POSTGRESQL..."
send "sudo -u postgres psql eon_platform -c \"SELECT 1;\"\r"
expect "*#*"

puts "ğŸ“‹ VERIFICANDO PORTA 5000..."
send "netstat -tlnp | grep :5000\r"
expect "*#*"

puts "ğŸ”„ TENTANDO REINICIAR SERVIDOR..."
send "pm2 restart iaeon-server\r"
expect "*#*"

send "sleep 3 && pm2 status\r"
expect "*#*"

puts "ğŸ§ª TESTANDO CONEXÃƒO LOCAL..."
send "curl -v http://localhost:5000/api/auth/login\r"
expect "*#*"

interact