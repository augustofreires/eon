#!/usr/bin/expect -f

# Aplicar correÃ§Ã£o crÃ­tica de troca de contas
set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "âœ… Conectado - Aplicando correÃ§Ã£o crÃ­tica\n"

# Ir para o diretÃ³rio do projeto
send "cd /root/eon\r"
expect "# "

# Fazer backup do arquivo atual
send "cp server/routes/auth.js server/routes/auth.js.backup.critical_\$(date +%Y%m%d_%H%M%S)\r"
expect "# "
send_user "âœ… Backup criado\n"

# Verificar se a correÃ§Ã£o jÃ¡ existe
send "grep -n 'Account mismatch' server/routes/auth.js\r"
expect "# "

send_user "ğŸ”§ Preparando para aplicar correÃ§Ã£o...\n"
send_user "ğŸ“ Arquivo: /root/eon/server/routes/auth.js\n"
send_user "ğŸš€ PM2: eon-pro-server\n"

# Manter sessÃ£o ativa para prÃ³ximos comandos
send "pwd\r"
expect "# "

send "ls -la server/routes/auth.js\r"
expect "# "

send_user "\nğŸ¯ PRONTO PARA UPLOAD DA CORREÃ‡ÃƒO\n"
send_user "ğŸ“¤ Execute: scp da correÃ§Ã£o\n"
send_user "ğŸ”„ Execute: pm2 restart eon-pro-server\n\n"

interact