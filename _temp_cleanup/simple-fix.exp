#!/usr/bin/expect -f

set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
   "password:" {
       send "62uDLW4RJ9ae28EPVfp5yzT##\r"
   }
}

expect "# "
send "cd /root/eon\r"
expect "# "

send_user "🔧 DESABILITANDO RATE LIMITING\n"

send "sed -i '/const limiter = rateLimit/,/app.use.*limiter/ s/^/\\/\\/ /' server/index.js\r"
expect "# "

send "pm2 restart eon-pro-server\r"
expect "# "

send "sleep 8\r"
expect "# "

send_user "🧪 TESTANDO:\n"
send "curl -s 'http://localhost:5001/api/health' && echo ' ✅ FUNCIONOU!' || echo ' ❌ FALHOU'\r"
expect "# "

interact
