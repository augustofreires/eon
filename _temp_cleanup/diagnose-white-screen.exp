#!/usr/bin/expect -f

# Diagnosticar problema de tela branca no site
set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "🔍 Diagnosticando tela branca no iaeon.site\n"

send "cd /root/eon\r"
expect "# "

# Verificar status do PM2
send_user "📊 Status do PM2:\n"
send "pm2 status\r"
expect "# "

# Verificar logs recentes
send_user "\n📋 Logs recentes do servidor:\n"
send "pm2 logs eon-pro-server --lines 20\r"
expect "# "

# Verificar se o processo está respondendo
send_user "\n🌐 Testando API do servidor:\n"
send "curl -I http://localhost:3001/api/health 2>/dev/null || echo 'API não responde'\r"
expect "# "

# Verificar configuração do Nginx
send_user "\n🔧 Verificando Nginx:\n"
send "systemctl status nginx | head -10\r"
expect "# "

# Verificar configuração do site
send "nginx -t\r"
expect "# "

# Verificar se os arquivos estão servindo
send "curl -I https://iaeon.site 2>/dev/null | head -5 || echo 'Site não responde'\r"
expect "# "

send_user "\n🎯 Diagnóstico completo\n"

interact