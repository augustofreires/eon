#!/usr/bin/expect -f
set timeout 30
spawn ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@31.97.28.231
expect {
    "Enter passphrase" { send "\r"; exp_continue }
    "password:" { send "62uDLW4RJ9ae28EPVfp5yzT##\r"; expect "root@" }
    "root@" { }
}

send "cd /root/eon\r"
expect "root@"

send "echo 'ðŸŽ¯ DEPLOY FINAL - CORREÃ‡ÃƒO OFICIAL DERIV API ==='\\r"
expect "root@"

send "git pull origin main\r"
expect "root@"

send "pm2 restart iaeon-server\r"
expect "root@"

send "sleep 5\r"
expect "root@"

send "echo ''\r"
expect "root@"

send "echo 'ðŸŽ‰ CORREÃ‡ÃƒO OFICIAL IMPLEMENTADA!'\\r"
expect "root@"

send "echo 'Agora usando account_list API da Deriv (mÃ©todo oficial)'\\r"
expect "root@"

send "echo ''\\r"
expect "root@"

send "echo 'ðŸ§ª TESTE DEFINITIVO:'\\r"
expect "root@"

send "echo '1. VÃ¡ para https://iaeon.site/operations'\\r"
expect "root@"

send "echo '2. Desconecte da Deriv se jÃ¡ estiver conectado'\\r"
expect "root@"

send "echo '3. Clique \"Conectar com Deriv\"'\\r"
expect "root@"

send "echo '4. Complete o login OAuth'\\r"
expect "root@"

send "echo '5. Aguarde 10 segundos e execute:'\\r"
expect "root@"

send "echo '   pm2 logs iaeon-server --lines 30 | grep -A5 \"CORREÃ‡ÃƒO DERIV\"'\\r"
expect "root@"

send "echo '6. Deve mostrar TODAS as suas contas!'\\r"
expect "root@"

send "exit\r"
expect eof