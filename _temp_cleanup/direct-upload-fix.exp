#!/usr/bin/expect -f

# Upload direto da correÃ§Ã£o crÃ­tica via SSH
set timeout 300

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "âœ… Conectado - Fazendo upload da correÃ§Ã£o\n"

# Ir para o diretÃ³rio
send "cd /root/eon\r"
expect "# "

# Aplicar a correÃ§Ã£o diretamente via sed
send_user "ğŸ”§ Aplicando correÃ§Ã£o crÃ­tica no auth.js\n"

# Verificar linha onde deve ser inserida a validaÃ§Ã£o (prÃ³ximo ao authorize)
send "grep -n 'authorize.*loginid' server/routes/auth.js | head -5\r"
expect "# "

# Procurar onde estÃ¡ o processamento da resposta de autorizaÃ§Ã£o
send "grep -n -A5 -B5 'response.authorize' server/routes/auth.js\r"
expect "# "

send_user "ğŸ¯ Localizando ponto de inserÃ§Ã£o da validaÃ§Ã£o...\n"

# Procurar onde resolve o promise apÃ³s autorizaÃ§Ã£o
send "grep -n -A10 -B5 'resolve.*response' server/routes/auth.js\r"
expect "# "

send_user "ğŸ“ Preparado para aplicar validaÃ§Ã£o de conta\n"
send_user "ğŸ” Revisar os pontos acima para inserir a validaÃ§Ã£o\n"

interact