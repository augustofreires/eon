#!/usr/bin/expect -f

set timeout 60

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "📊 Verificando dados específicos dos bots..."

# Ver dados dos bots
send "sqlite3 ./server/database.sqlite \"SELECT id, name, description, is_active FROM bots;\"\r"
expect "*#*"

# Verificar bots ativos
send "sqlite3 ./server/database.sqlite \"SELECT id, name, is_active FROM bots WHERE is_active = 1;\"\r"
expect "*#*"

puts "🔍 Testando endpoint diretamente..."

# Testar endpoint sem autenticação
send "curl -X GET http://localhost:5000/api/bots -H \"Content-Type: application/json\" 2>/dev/null | head -100\r"
expect "*#*"

puts "🔑 Verificando autenticação necessária..."

# Ver se precisa de token
send "grep -n \"authenticateToken\" ./server/routes/bots.js | head -3\r"
expect "*#*"

puts "🔍 Verificando como frontend carrega bots..."

# Ver como frontend carrega bots
send "grep -rn \"loadAvailableBots\\|/api/bots\" ./client/src/ | head -5\r"
expect "*#*"

# Ver função específica no OperationsPage
send "grep -n -A 10 -B 5 \"loadAvailableBots\" ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

puts "📋 Investigação dos dados dos bots concluída."

interact