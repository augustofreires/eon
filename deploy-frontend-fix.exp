#!/usr/bin/expect -f

set timeout 60
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        puts "\nüöÄ FAZENDO DEPLOY DO FRONTEND CORRIGIDO..."

        # Navegar para o diret√≥rio web
        send "cd /var/www/html\r"
        expect "*# "

        # Fazer backup dos arquivos atuais
        puts "\nüì¶ Fazendo backup dos arquivos atuais..."
        send "cp -r static static.backup.$(date +%Y%m%d-%H%M%S)\r"
        expect "*# "

        # Limpar arquivos antigos do build
        send "rm -rf static/js/*.js static/css/*.css\r"
        expect "*# "

        puts "\nüìÇ Arquivos atuais removidos, aguardando upload..."
        send "ls -la static/\r"
        expect "*# "

        puts "\n‚ö†Ô∏è  AGORA ENVIE OS ARQUIVOS VIA SCP EM OUTRO TERMINAL:"
        puts "scp -r client/build/* root@31.97.28.231:/var/www/html/"
        puts ""
        puts "Pressione ENTER quando terminar o upload..."

        # Aguardar input do usu√°rio
        send "read -p 'Pressione ENTER ap√≥s completar o upload...' && echo 'Upload confirmado'\r"
        expect "*# "

        # Verificar se os novos arquivos foram enviados
        puts "\nüîç Verificando arquivos ap√≥s upload..."
        send "ls -la static/js/ | head -5\r"
        expect "*# "

        send "ls -la static/css/ | head -5\r"
        expect "*# "

        puts "\n‚úÖ DEPLOY CONCLU√çDO! Teste a aplica√ß√£o em iaeon.site"
        send "exit\r"
    }
}

expect eof