#!/usr/bin/expect -f

set timeout 60
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        puts "\nğŸš€ ATUALIZANDO FRONTEND COM CORREÃ‡ÃƒO DOS BOTS..."

        # Navegar para o diretÃ³rio do projeto
        send "cd /root/eon\r"
        expect "*# "

        # Atualizar o frontend no servidor
        puts "\nğŸ“ Atualizando loadAvailableBots no servidor..."
        send "sed -i 's/const botsData = Array.isArray(response.data) ? response.data : \\[\\];/let botsData = \\[\\]; if (response.data \\&\\& response.data.bots \\&\\& Array.isArray(response.data.bots)) { botsData = response.data.bots; } else if (Array.isArray(response.data)) { botsData = response.data; }/' /var/www/html/static/js/*.js\r"
        expect "*# "

        puts "\nğŸ”„ Reiniciando nginx..."
        send "systemctl reload nginx\r"
        expect "*# "

        puts "\nâœ… ATUALIZAÃ‡ÃƒO CONCLUÃDA!"
        puts "ğŸŒ Teste a aplicaÃ§Ã£o: https://iaeon.site/operations"
        puts "ğŸ“ Agora os bots devem aparecer corretamente!"

        send "exit\r"
    }
}

expect eof