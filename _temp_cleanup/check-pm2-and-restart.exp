#!/usr/bin/expect -f

set timeout 60

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "🔍 Verificando processos PM2...\n"

send "cd /root/eon\r"
expect "# "

send "pm2 list\r"
expect "# "

send_user "🔄 Tentando diferentes formas de restart...\n"

# Tentar restart por ID ou nome
send "pm2 restart all\r"
expect "# "

# Ou iniciar se não estiver rodando
send "pm2 start server/index.js --name server\r"
expect "# "

send_user "📋 Status final:\n"
send "pm2 list\r"
expect "# "

send_user "✅ Servidor deve estar rodando agora!\n"

interact