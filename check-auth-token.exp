#!/usr/bin/expect -f

set timeout 60

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "🔍 Verificando configuração de token no frontend..."

# Verificar configuração do axios com headers
send "grep -rn \"axios.*default.*headers\\|Authorization\" ./client/src/ | head -5\r"
expect "*#*"

# Ver configuração de token no AuthContext
send "grep -rn \"token.*header\\|axios.*token\" ./client/src/contexts/AuthContext.tsx\r"
expect "*#*"

# Verificar localStorage token
send "grep -rn \"localStorage.*token\" ./client/src/ | head -5\r"
expect "*#*"

puts "🔍 Verificando interceptador do axios..."

# Procurar por interceptors
send "grep -rn \"interceptor\\|intercepted\" ./client/src/ | head -3\r"
expect "*#*"

# Ver como token é configurado no axios
send "grep -n -A 5 -B 5 \"axios.defaults\" ./client/src/contexts/AuthContext.tsx\r"
expect "*#*"

puts "🧪 Testando com token simulado..."

# Simular um token para testar o endpoint
send "TOKEN='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test'; curl -X GET http://localhost:5000/api/bots -H \"Authorization: Bearer \\$TOKEN\" 2>/dev/null | head -100\r"
expect "*#*"

puts "📋 Verificação de autenticação concluída."

interact