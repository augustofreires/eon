#!/usr/bin/expect -f

set timeout 30

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "🔍 VERIFICANDO CONFIGURAÇÃO DO BANCO DE DADOS..."

# Verificar arquivo de configuração do banco
send "find . -name '*.env*' -o -name 'config*' -o -name 'database*' | head -10\r"
expect "*#*"

puts "📋 VERIFICANDO ARQUIVO .env..."
send "cat .env 2>/dev/null || echo 'Arquivo .env não encontrado'\r"
expect "*#*"

puts "📋 VERIFICANDO server/.env..."
send "cat server/.env 2>/dev/null || echo 'Arquivo server/.env não encontrado'\r"
expect "*#*"

puts "🔍 PROCURANDO CONFIGURAÇÃO DE DATABASE NO CÓDIGO..."
send "grep -r 'DATABASE\\|DB_' server/ | head -5\r"
expect "*#*"

puts "🔍 VERIFICANDO ARQUIVOS DE CONFIGURAÇÃO DO BANCO..."
send "find server/ -name '*.js' -exec grep -l 'sqlite\\|postgres\\|mysql' {} \\; | head -3\r"
expect "*#*"

puts "📋 VERIFICANDO CONEXÃO ATUAL..."
send "ls -la server/ | grep -E '\\.(db|sqlite)'\r"
expect "*#*"

puts "📋 VERIFICANDO SE HÁ POSTGRESQL INSTALADO..."
send "which psql || echo 'PostgreSQL não encontrado'\r"
expect "*#*"

puts "📋 VERIFICANDO PROCESSOS DE BANCO..."
send "ps aux | grep -E 'postgres|mysql' | grep -v grep\r"
expect "*#*"

interact