#!/usr/bin/expect -f

set timeout 60

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "🔍 Verificando interceptor completo do axios..."

# Ver interceptor completo
send "sed -n '60,75p' ./client/src/contexts/AuthContext.tsx\r"
expect "*#*"

puts "🧪 Testando login para obter token real..."

# Fazer login para obter token
send "curl -X POST http://localhost:5000/api/auth/login -H \"Content-Type: application/json\" -d '{\"email\":\"cliente@iaeon.com\",\"password\":\"123456\",\"isAdmin\":false}' 2>/dev/null\r"
expect "*#*"

puts "🔍 Verificando se há logs de erro no servidor..."

# Ver logs recentes do servidor para erros
send "pm2 logs --lines 5 | tail -10\r"
expect "*#*"

puts "📋 Vou também verificar se a função loadAvailableBots tem try/catch adequado..."

# Ver tratamento de erro na função loadAvailableBots
send "sed -n '98,110p' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

interact