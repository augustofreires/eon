#!/usr/bin/expect -f
set timeout 120
set password "62uDLW4RJ9ae28EPVfp5yzT##"

puts "🔍 Debugging why account switching still doesn't work..."

spawn ssh root@31.97.28.231
expect {
  "Enter passphrase for key" { interact -o "\n" }
  "assword:" { send "$password\r" }
}

expect "# "
send "cd /root/eon\r"
expect "# "

puts "📋 Check if frontend needs rebuild..."
send "ls -la client/build/ | head -5\r"
expect "# "

puts "📋 Check if React is running in dev/prod mode..."
send "pm2 logs eon-backend --lines 5 | grep -E '(dev|prod|build)'\r"
expect "# "

puts "📋 Check browser cache issue - look for static files..."
send "ls -la client/build/static/js/ | tail -3\r"
expect "# "

puts "📋 Force restart both services..."
send "pm2 restart all\r"
expect "# "

puts "📋 Check if there are any JavaScript errors in recent logs..."
send "pm2 logs --lines 20 | grep -iE '(error|failed|exception)' | tail -5\r"
expect "# "

puts "🎯 Debug complete. The issue might be browser cache or build process."
send "exit\r"
expect eof
