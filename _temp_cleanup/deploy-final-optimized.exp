#!/usr/bin/expect -f

set timeout 60
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        puts "\nğŸš€ DEPLOY FINAL OTIMIZADO..."

        # Copiar novo build
        send "cd /root/eon/client && cp -r build/* /var/www/html/\r"
        expect "*# "

        # Verificar novo arquivo
        send "ls -la /var/www/html/static/js/main*.js\r"
        expect "*# "

        # Reiniciar nginx
        send "systemctl reload nginx\r"
        expect "*# "

        puts "\nâœ… DEPLOY CONCLUÃDO COM TODAS AS OTIMIZAÃ‡Ã•ES!"
        puts "ğŸŒ Teste: https://iaeon.site/operations"
        puts ""
        puts "ğŸ¯ CORREÃ‡Ã•ES APLICADAS PELO AGENTE:"
        puts "   âœ“ FunÃ§Ã£o loadAvailableBots() simplificada"
        puts "   âœ“ Removido log 'Link Deriv carregado' do console"
        puts "   âœ“ Interface simplificada seguindo padrÃ£o EonPro"
        puts "   âœ“ useEffect otimizado sem loops circulares"
        puts "   âœ“ Estado derivConnected centralizado"
        puts "   âœ“ BotÃµes de refresh sem chamadas duplicadas"
        puts "   âœ“ Console limpo sem logs desnecessÃ¡rios"
        puts ""
        puts "ğŸ“‹ TESTE ESPERADO:"
        puts "   1. Login como cliente@iaeon.com / 123456"
        puts "   2. Conectar conta Deriv"
        puts "   3. Ver 3 bots disponÃ­veis automaticamente"
        puts "   4. Console limpo sem logs verbosos"
        puts ""
        puts "âš¡ Tamanho reduzido: -729 B (mais otimizado)"

        send "exit\r"
    }
}

expect eof