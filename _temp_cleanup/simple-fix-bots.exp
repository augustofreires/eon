#!/usr/bin/expect -f

set timeout 30
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        puts "\nğŸ”§ Aplicando correÃ§Ã£o simples dos bots..."

        send "cd /var/www/html/static/js\r"
        expect "*# "

        # Listar arquivos JS
        send "ls -la *.js\r"
        expect "*# "

        # Fazer uma correÃ§Ã£o simples no arquivo JS principal
        puts "\nğŸ“ Aplicando correÃ§Ã£o no JavaScript..."
        send "sed -i 's/Array\\.isArray(.*\\.data)?.*\\.data:\\[\\]/response.data\\&\\&response.data.bots\\&\\&Array.isArray(response.data.bots)?response.data.bots:Array.isArray(response.data)?response.data:[]/g' main*.js\r"
        expect "*# "

        puts "\nğŸ”„ Recarregando nginx..."
        send "systemctl reload nginx\r"
        expect "*# "

        puts "\nâœ… CORREÃ‡ÃƒO APLICADA!"
        puts "ğŸŒ Teste: https://iaeon.site/operations"

        send "exit\r"
    }
}

expect eof