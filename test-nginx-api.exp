#!/usr/bin/expect -f
set timeout 30

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231
expect "password:"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "#"

send "cd /root/eon\r"
expect "#"

# Testar a API através do Nginx (HTTPS)
send "curl -k -s -X POST https://iaeon.site/api/auth/login -H \"Content-Type: application/json\" -d '{\"email\":\"cliente@iaeon.com\",\"password\":\"123456\"}'\r"
expect "#"

# Verificar configuração do Nginx
send "cat /etc/nginx/sites-enabled/iaeon.site | grep -A 10 -B 5 proxy_pass\r"
expect "#"

# Testar diretamente na porta 5000 (onde o Node está rodando)
send "curl -s -X POST http://localhost:5000/api/auth/login -H \"Content-Type: application/json\" -d '{\"email\":\"cliente@iaeon.com\",\"password\":\"123456\"}'\r"
expect "#"

send "exit\r"
expect eof
