#!/usr/bin/expect -f
set timeout 300
set password "62uDLW4RJ9ae28EPVfp5yzT##"

# Upload backend with enhanced debugging logs
puts "ğŸ“¦ Uploading enhanced debugging backend..."
spawn scp server/routes/auth.js root@31.97.28.231:/root/eon/server/routes/
expect {
  "Enter passphrase for key" {
    interact
  }
  "assword:" {
    send "$password\r"
    exp_continue
  }
  "100%" {
    puts "âœ… Backend uploaded successfully"
  }
  timeout {
    puts "âŒ Upload timeout"
    exit 1
  }
}

# Upload frontend with enhanced debugging logs
puts "ğŸ“¦ Uploading enhanced debugging frontend..."
spawn scp client/src/contexts/AuthContext.tsx root@31.97.28.231:/root/eon/client/src/contexts/
expect {
  "Enter passphrase for key" {
    interact
  }
  "assword:" {
    send "$password\r"
    exp_continue
  }
  "100%" {
    puts "âœ… Frontend uploaded successfully"
  }
  timeout {
    puts "âŒ Upload timeout"
    exit 1
  }
}

# Connect and restart
puts "ğŸ”Œ Connecting to restart server..."
spawn ssh root@31.97.28.231
expect {
  "Enter passphrase for key" {
    interact -o "\n"
  }
  "assword:" {
    send "$password\r"
  }
}

expect "# "
send "cd /root/eon\r"
expect "# "

puts "ğŸ”„ Restarting server with debugging..."
send "pm2 restart eon-backend\r"
expect "# "

puts "ğŸ“‹ Checking server logs..."
send "pm2 logs eon-backend --lines 10\r"
expect "# "

puts "ğŸ¯ Ready for testing! Server restarted with enhanced logs."
puts ""
puts "ğŸ§ª Test now at https://iaeon.site"
puts "ğŸ“Š Check logs with: pm2 logs eon-backend"
puts ""

send "exit\r"
expect eof
