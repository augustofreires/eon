#!/usr/bin/expect -f

set timeout 300
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh root@31.97.28.231

expect {
    "passphrase" {
        send "\r"
        exp_continue
    }
    "password:" {
        send "$password\r"
        exp_continue
    }
    "# " {
        puts "✅ Conectado para debug"
    }
}

send "cd /root/eon\r"
expect "# "

puts "🔍 Verificando logs do PM2..."
send "pm2 logs iaeon-server --lines 30\r"
expect "# "

puts "🔍 Testando endpoint switch-account manualmente..."
send "curl -X POST http://localhost:3001/api/auth/deriv/switch-account -H \"Content-Type: application/json\" -d '{\"test\": true}'\r"
expect "# "

puts "🔍 Verificando se o arquivo auth.js foi atualizado..."
send "grep -n \"Buscar saldo atual da nova conta\" server/routes/auth.js\r"
expect "# "

puts "🔍 Verificando última modificação do arquivo..."
send "ls -la server/routes/auth.js\r"
expect "# "

puts "🔍 Verificando status do servidor..."
send "pm2 status\r"
expect "# "

puts "🔍 Monitorando logs em tempo real (pressione Ctrl+C para sair)..."
interact