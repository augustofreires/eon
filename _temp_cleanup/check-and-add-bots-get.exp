#!/usr/bin/expect -f
set timeout 30

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231
expect "password:"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "#"

send "cd /root/eon/server/routes\r"
expect "#"

# Verificar se há um GET endpoint no bots.js
send "grep -n \"router.get\" bots.js\r"
expect "#"

# Se não houver, adicionar endpoint GET
send "echo '

// Endpoint para listar bots (GET)
router.get(\"/\", authenticateToken, async (req, res) => {
  try {
    console.log(\"📋 Buscando bots disponíveis...\");
    
    const result = await query(\`
      SELECT id, name, description, image_url, is_active, created_at
      FROM bots 
      WHERE is_active = true 
      ORDER BY name ASC
    \`);
    
    console.log(\`✅ \${result.rows.length} bots encontrados\`);
    
    res.json(result.rows);
    
  } catch (error) {
    console.error(\"❌ Erro ao buscar bots:\", error);
    res.status(500).json({ 
      error: \"Erro interno do servidor\"
    });
  }
});' >> bots.js\r"
expect "#"

# Reiniciar PM2
send "cd /root/eon && pm2 restart iaeon-server\r"
expect "#"

send "exit\r"
expect eof
