#!/usr/bin/expect -f

set timeout 30
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        puts "\nüîç TESTANDO TODAS AS DATABASES..."

        # Testar deriv_bots_db
        puts "\n1Ô∏è‚É£ TESTANDO deriv_bots_db:"
        send "su - postgres -c \"psql deriv_bots_db -c 'SELECT id, name FROM bots LIMIT 3;'\"\r"
        expect "*# "

        # Testar derivbots_production
        puts "\n2Ô∏è‚É£ TESTANDO derivbots_production:"
        send "su - postgres -c \"psql derivbots_production -c 'SELECT id, name FROM bots LIMIT 3;'\"\r"
        expect "*# "

        # Testar eon_platform
        puts "\n3Ô∏è‚É£ TESTANDO eon_platform:"
        send "su - postgres -c \"psql eon_platform -c 'SELECT id, name FROM bots LIMIT 3;'\"\r"
        expect "*# "

        # Verificar .env do servidor
        puts "\n4Ô∏è‚É£ VERIFICANDO .ENV:"
        send "cd /root/eon/server && head -10 .env\r"
        expect "*# "

        puts "\n‚úÖ TESTES COMPLETOS"
        send "exit\r"
    }
}

expect eof