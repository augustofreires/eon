#!/usr/bin/expect -f

set timeout 30

spawn ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "password:" {
        send "62uDLW4RJ9ae28EPVfp5yzT##\r"
    }
}

expect "# "
send_user "📋 VERIFICANDO LOGS DE SWITCH-ACCOUNT ESPECÍFICOS...\n"

send "cd /root/eon\r"
expect "# "

# Verificar logs das últimas tentativas de switch
send_user "🔍 Logs das últimas tentativas:\n"
send "pm2 logs eon-pro-server --lines 50 | grep -A10 -B5 'INICIO SWITCH-ACCOUNT\\|Account mismatch\\|requested.*but got'\r"
expect "# "

send_user "\n🔍 Logs específicos de get-token:\n"
send "pm2 logs eon-pro-server --lines 50 | grep -A5 -B5 'CRITICAL.*token\\|Found specific token'\r"
expect "# "

interact