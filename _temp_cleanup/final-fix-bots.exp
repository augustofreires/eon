#!/usr/bin/expect -f

set timeout 30
set password "62uDLW4RJ9ae28EPVfp5yzT##"

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect {
    "*password:" {
        send "$password\r"
        exp_continue
    }
    "*# " {
        puts "\nüîß CORRIGINDO DATABASE eon_platform..."

        # Ver estrutura da tabela bots
        puts "\n1Ô∏è‚É£ ESTRUTURA DA TABELA BOTS:"
        send "su - postgres -c \"psql eon_platform -c '\\\\d bots'\"\r"
        expect "*# "

        # Inserir bots na database correta com estrutura certa
        puts "\n2Ô∏è‚É£ INSERINDO BOTS:"
        send "su - postgres -c \"psql eon_platform -c \\\"INSERT INTO bots (name, status, file_path, created_at) VALUES ('Bot Martingale', 'active', '/bots/martingale.xml', NOW()), ('Bot Max Take', 'active', '/bots/max_take.xml', NOW()), ('Bot CC', 'active', '/bots/cc.xml', NOW()) ON CONFLICT (name) DO NOTHING;\\\"\"\r"
        expect "*# "

        # Verificar se os bots foram inseridos
        puts "\n3Ô∏è‚É£ VERIFICANDO BOTS:"
        send "su - postgres -c \"psql eon_platform -c 'SELECT id, name, status FROM bots;'\"\r"
        expect "*# "

        # Verificar usu√°rios para fazer login
        puts "\n4Ô∏è‚É£ VERIFICANDO USU√ÅRIOS:"
        send "su - postgres -c \"psql eon_platform -c 'SELECT id, email FROM users LIMIT 3;'\"\r"
        expect "*# "

        puts "\n‚úÖ CORRE√á√ÉO FINAL COMPLETA"
        send "exit\r"
    }
}

expect eof