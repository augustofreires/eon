#!/usr/bin/expect -f

set timeout 45

spawn ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -o PubkeyAuthentication=no root@31.97.28.231

expect "*assword*"
send "62uDLW4RJ9ae28EPVfp5yzT##\r"
expect "*#*"

send "cd /root/eon\r"
expect "*#*"

puts "ğŸ”„ RESTAURANDO BACKUP ORIGINAL..."

# Usar backup limpo do inÃ­cio
send "cp ./client/src/pages/OperationsPage.tsx.backup-bots ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

puts "ğŸ” VERIFICANDO LINHA ORIGINAL..."
send "sed -n '102p' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

puts "ğŸ”§ APLICANDO CORREÃ‡ÃƒO SIMPLES..."

# CorreÃ§Ã£o simples: response.data para response.data.bots || response.data
send "sed -i '102s/response\\.data/response.data.bots || response.data/' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

# Verificar correÃ§Ã£o
send "sed -n '102p' ./client/src/pages/OperationsPage.tsx\r"
expect "*#*"

puts "ğŸ—ï¸ BUILD COM CORREÃ‡ÃƒO SIMPLES..."
send "cd client && npm run build\r"
expect {
    "*build folder is ready*" {
        puts "âœ… BUILD FUNCIONOU!"
    }
    "*compiled successfully*" {
        puts "âœ… BUILD FUNCIONOU!"
    }
    "*Failed*" {
        puts "âŒ Ainda com erro"
    }
    timeout {
        puts "â° Building..."
    }
}
expect "*#*"

send "cd /root/eon && pm2 restart all\r"
expect "*#*"

puts ""
puts "ğŸ¯ CORREÃ‡ÃƒO SIMPLES APLICADA!"
puts "ğŸ§ª TESTE: https://iaeon.site/operations"

interact